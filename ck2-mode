(add-to-list 'load-path
			 "~/.emacs.d/plugins/")
(load "highlight-indentation")
(require 'highlight-indentation)

(setq ck2-font-lock-keywords
	  (let* (
			 ;; define several category of keywords
			 (x-keywords '("if" "NOR" "NOT" "OR" "immediate" "AND" "╖" "FROM" "random_events" "random_list" "limit" "ROOT"  "random_real_character" "random" "reverse_option" ;; blue. all colours are depends which !symbols
						   "potential" "allow" "revoke_allowed" "ai_will_do" "active" "weight" "artifacts" "spawn_chance" "spriteTypes" "spriteType" "add_character_modifier" "opinion" ;; color scheme used. check "font-lock*"
						   "allowed_gift" "decisions" "liege" "ai_will_do" "modifier"
						   )) 

		     (x-traits '( "stacking" "indestructible" "slot"  "ceremonial_weapon" "scepter" "crown" "wrist" "neck" "torso" "quality" "death" "wounded" "one_legged" ; dark green (NOT BROWN-green!) ! symbols
						 "celibate" "hedonist" "scholar" "gardener" "mystic" "impaler" "duelist" "hunter" "poet" "falconer" "lustful" "chaste" "gluttonous" "temperate" "greedy" "charitable" "slothful" "diligent" "envious" "kind" "wroth" "patient" "proud" "humble" "OTHER" "deceitful" "honest" "craven" "brave" "shy" "gregarious" "ambitious" "content" "arbitrary" "just" "cynical" "zealous" "paranoid" "trusting" "cruel" "light_foot_leader" "heavy_infantry_leader" "cavalry_leader" "inspiring_leader" "trickster" "organizer" "defensive_leader" "experimenter" "flanker" "aggressive_leader" "scarred" "eunuch" "blinded" "born_in_the_purple" "augustus" "flat_terrain_leader" "rough_terrain_leader" "mountain_terrain_leader" "desert_terrain_leader" "holy_warrior" "unyielding_leader" "has_aztec_disease" "bracken" "blackwood" "kingsguard" "tiger" "giant" "has_grey_plague" "has_greyscale" "has_bloody_flux" "not_a_bear" "has_pox" "has_missing" "nightswatch" "turncloak" "deserter" "fire_obsessed" "Wildling" "Pirate" "People hunting" "hunting" "winterhorn" "Reaving" "salt_wife" "poor_warrior" "trained_warrior" "skilled_warrior" "master_warrior" "dothraki" "dosh_khaleen" "inherit" "dragon_egg" "child_dragon" "wild_dragon" "dragon" "dragon_slayer" "knight" "squire" "money_lender" "detached_priest" "martial_cleric" "scholarly_theologian" "mastermind_theologian" "incompetent_scientist" "dutiful_academic" "expert_scientist" "mastermind_scholar" "maester" "fashionable" "crippled" "rude" "authoritative" "ruthless" "blind" "honorable" "back_seat_leader" "silent_sister" "red_priest" "favored_by_rhllor" "chosen_by_rhlor" "drowned" "grace" "stubborn" "warlock" "crow" "wolf" "greensight" "sea_lion" "whale" "eagle" "shadowcat" "boar" "snowbear" "direwolf" "slave" "slave_trader" "slave_owner" "former_slave" "liberator" "rebel_leader" "dead_target" "kingsmoot target" "employseer" "employhedge" "employmarshall" "employpriest" "employsteward" "employchancelor" "employspy" "employdebutante" "wikiddirewolf" "wikidcrow" "wikideagle" "wikiddog" "pending_infection" "severely_injured"
						 "infection" "lunatic" "pending_infection" "fever" "martial" "diplomacy" "intrigue" "stewardship" "learning" "base_health" "demesne_efficiency" "decadence" "dynasty_realm_power" "fertility" "infamy" "mercenary_siphon_factor" "monthly_income" "plot_power" "population_factor" "relative_power_to_liege" "religion_authority" "revolt_risk" "scaled_wealth" "wealth" "yearly_income" "ai_ambition" "ai_greed" "ai_honor" "ai_rationality" "ai_zeal" "among_most_powerful_vassals" "combat_rating" "demesne_garrison_size" "demesne_size" "health_traits" "imprisoned_days" "lifestyle_traits" "max_manpower" "num_fitting_characters_for_title" "num_of_baron_titles" "num_of_buildings" "num_of_children" "num_of_claims" "num_of_consorts" "num_of_count_titles" "num_of_count_titles_in_realm" "num_of_duke_titles" "num_of_dynasty_members" "num_of_emperor_titles" "num_of_empty_holdings" "num_of_extra_landed_titles" "num_of_feuds" "num_of_friends" "num_of_holy_sites" "num_of_king_titles" "num_of_lovers" "num_of_max_settlements" "num_of_plot_backers" "num_of_prisoners" "num_of_rivals" "num_of_settlements" "num_of_subrealm_castles" "num_of_subrealm_cities" "num_of_spouses" "num_of_titles" "num_of_trade_posts" "num_of_traits" "num_of_unique_dynasty_vassals" "num_of_vassals" "over_max_demesne_size" "over_vassal_limit" "personality_traits" "piety" "population" "population_and_manpower" "prestige" "realm_diplomacy" "realm_intrigue" "realm_learning" "realm_martial" "realm_stewardship" "realm_levies" "realm_levies_plus_allies" "max_realm_levies" "realm_size" "republic_total_num_of_trade_posts" "ruled_years" "score" "unused_manpower" "retinue_points_max" "retinue_points_used" "retinue_points_free" "total_tax_value" "holding_tax_value" "dynastic_prestige" "society_currency"
						 "archmaester" "monthly_character_prestige" "monthly_character_piety"
						 "vassal_opinion" "combat_rating" 
						 ))
			 
			 (x-types '("add_artifact" "add_trait" "remove_trait" "days" "months" "years" "text" "regent" "trait" "who" "chance" "ai" ; brown-green !symbols
						"clr_character_flag" "set_character_flag" "remove_character_modifier" 				
						))
			 (x-constants '("EVTOPTA" "EVTOPTB" "EVTDESC" "EVTOPTC" "EVTOPTD" "EVTNAME" "EVTDESC" "RIP" "EVTDESCA" ;; light blue !w
							"hidden" "tooltip_info" "events" 
							"TOOLTIP" "GFX_evt" "GFX_event" "hidden_tooltip" "custom_tooltip" "tooltip_info" "texturefile"
							))
			 
			 (x-events '("only_playable" "is_part_of_plot" "only_rulers" "religion" "religion_group" "culture_group" ; green !symbols			 
						 "min_age" "max_age" "age" "only_independent" "only_men" "only_women" "only_capable" "capable_only" "lacks_dlc" "has_dlc" "friends" "rivals" "prisoner" "ai_chance" "is_patrician" "is_female" "is_married"
						 "is_ill" "is_incapable" "pilgrim" "job" "job_castellan" "job_chancellor" "job_treasurer" "job_physician" "has" "has_job_title" "has_game_rule" "has_character_modifier" "had_character_flag" "had_dinasty_flag" "disease_not_serious " "has_regent" "has_character_flag"
						 "had" "not" "have" "artifact" "war" "culture" "culture_group" "is_in_society" "recalc_succession""drowned_god" "seven_gods" 
						 "on_startup" "on_yearly_pulse" "on_bi_yearly_pulse" "on_five_year_pulse" "namespace"
						 ))
			 
			 (x-functionsid '( "id" "desc" "picture" "border" "major" "is_triggered_only" "triggered_from_code" "hide_from" "hide_new" "hide_window" "show_root" ; yellow !w
							  "show_from_from" "show_from_from_from" "sound" "notification" "name" "value" "is_ruler" "path" "user_dir" "archive" "replace_path" "dependencies"
							  "tags" "supported_chechsums" "slots" "spawn_date" "max_amount" "factor"
							  "is_high_prio" "always" "title" "is_nomadic" "is_councillor" 

							  ))
			 
			 (x-functions '( "character_event" "long_character_event" "letter_event" "narrative_event" "province_event" "diploresponse_event" "unit_event" "society_quest_event" ; pink
							"option" "trigger" "mean_time_to_happen" "weight_multiplayer" "immediate"  "effect"))

			 ;; generate regex string for each category of keywords
			 (x-keywords-regexp (regexp-opt x-keywords 'symbols)) ;; S
  			 (x-types-regexp (regexp-opt x-types 'symbols))
			 (x-traits-regexp (regexp-opt x-traits 'symbols)) ;; S
			 (x-constants-regexp (regexp-opt x-constants 'words))
			 (x-events-regexp (regexp-opt x-events 'symbols)) ;; S
			 (x-functionsid-regexp (regexp-opt x-functionsid 'words))
			 (x-functions-regexp (regexp-opt x-functions 'words)))

		  `(
		    (,x-types-regexp . font-lock-type-face)
			(,x-constants-regexp . font-lock-constant-face)
			(,x-events-regexp . font-lock-string-face)			
			(,x-traits-regexp . font-lock-warning-face) 
			(,x-functionsid-regexp . font-lock-doc-face)
			(,x-functions-regexp . font-lock-function-name-face)
			(,x-keywords-regexp . font-lock-keyword-face)
			;; note: order above matters, because once colored, that part won't change.
			;; in general, put longer words first
			)))

;;;###autoload
(define-derived-mode ck2-mode lua-mode "crusader kings 2 mode" ;; do you have lua-mode?
					 "Major mode for editing ck2 (Crusader Kings 2)…"

					 (setq font-lock-defaults '((ck2-font-lock-keywords))))

;; add the mode to the `features' list
(provide 'ck2-mode)

(add-hook 'lua-mode-hook
		  (lambda ()
			  (modify-syntax-entry ?\' "." lua-mode-syntax-table)))

(setq auto-mode-alist (append '(("\\.txt$" . ck2-mode))
							  '(("\\.csv$" . ck2-mode))
							  '(("\\.gfx$" . ck2-mode))
							  '(("\\.el$" . emacs-lisp-mode))
							  auto-mode-alist)) ;; imporant

